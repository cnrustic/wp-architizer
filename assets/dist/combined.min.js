class ProductFilter{constructor(){this.filterForm=document.querySelector(".product-filter-form"),this.productGrid=document.querySelector(".product-grid"),this.init()}init(){this.filterForm&&(this.filterForm.addEventListener("submit",this.handleSubmit.bind(this)),this.initAjaxFilters())}async handleSubmit(e){e.preventDefault()}initAjaxFilters(){}}new ProductFilter,(i=>{class e{constructor(){this.$header=i(".site-header"),this.$searchToggle=i(".search-toggle"),this.$searchDropdown=i(".search-dropdown"),this.$searchOverlay=i(".search-overlay"),this.$searchInput=i(".search-input"),this.$userToggle=i(".user-toggle"),this.$userDropdown=i(".user-dropdown"),this.$mobileMenuToggle=i(".mobile-menu-toggle"),this.$mobileMenu=i(".mobile-menu"),this.lastScrollTop=0,this.isSearchActive=!1,this.init()}init(){this.bindEvents(),this.initScrollBehavior(),this.initMobileMenu(),this.initSearchAutocomplete()}bindEvents(){this.$searchToggle.on("click",e=>{e.preventDefault(),this.toggleSearch()}),i(document).on("keydown",e=>{"/"!==e.key||this.isSearchActive||(e.preventDefault(),this.toggleSearch()),"Escape"===e.key&&this.isSearchActive&&this.closeSearch()}),this.$userToggle.on("click",e=>{e.preventDefault(),this.toggleUserMenu()}),this.$mobileMenuToggle.on("click",e=>{e.preventDefault(),this.toggleMobileMenu()}),i(document).on("click",e=>{this.handleClickOutside(e)})}toggleSearch(){this.isSearchActive=!this.isSearchActive,this.$searchDropdown.toggleClass("active"),this.$searchOverlay.toggleClass("active"),this.isSearchActive?(this.$searchInput.focus(),i("body").addClass("search-active")):i("body").removeClass("search-active")}closeSearch(){this.isSearchActive=!1,this.$searchDropdown.removeClass("active"),this.$searchOverlay.removeClass("active"),i("body").removeClass("search-active")}initSearchAutocomplete(){let i;this.$searchInput.on("input",e=>{clearTimeout(i);let t=e.target.value;2<=t.length&&(i=setTimeout(()=>{this.performSearch(t)},300))})}async performSearch(e){try{var t=await i.ajax({url:"/wp-json/wp/v2/search",data:{search:e,type:"post",subtype:["post","project","product","firm"],per_page:5}});this.updateSearchResults(t)}catch(e){console.error("Search error:",e)}}updateSearchResults(e){var t=this.$searchDropdown.find(".search-results");t.html(""),e.length?(e=e.map(e=>`
                    <a href="${e.url}" class="search-result-item">
                        <span class="result-type">${e.subtype}</span>
                        <span class="result-title">${e.title}</span>
                    </a>
                `).join(""),t.html(e)):t.html('<div class="no-results">未找到相关结果</div>')}initScrollBehavior(){let t=this.$header.outerHeight();i(window).on("scroll",()=>{var e=i(window).scrollTop();e>this.lastScrollTop&&e>t?this.$header.addClass("header-hidden"):this.$header.removeClass("header-hidden"),0<e?this.$header.addClass("header-shadow"):this.$header.removeClass("header-shadow"),this.lastScrollTop=e})}initMobileMenu(){this.$mobileMenu.find(".menu-item-has-children > a").after('<button class="submenu-toggle"><i class="fas fa-chevron-down"></i></button>'),this.$mobileMenu.on("click",".submenu-toggle",function(e){e.preventDefault();var e=i(this).siblings(".sub-menu"),t=i(this).find("i");e.slideToggle(300),t.toggleClass("fa-chevron-down fa-chevron-up")})}toggleMobileMenu(){this.$mobileMenu.toggleClass("active"),this.$mobileMenuToggle.toggleClass("active"),i("body").toggleClass("mobile-menu-active")}toggleUserMenu(){this.$userDropdown.toggleClass("active")}handleClickOutside(e){i(e.target).closest(".search-box").length||this.closeSearch(),i(e.target).closest(".user-menu").length||this.$userDropdown.removeClass("active"),i(e.target).closest(".mobile-menu, .mobile-menu-toggle").length||(this.$mobileMenu.removeClass("active"),this.$mobileMenuToggle.removeClass("active"),i("body").removeClass("mobile-menu-active"))}}i(document).ready(()=>{new e})})(jQuery),(r=>{window.Architizer=window.Architizer||{},Architizer.Home={init:function(){this.initHeroSlider(),this.initProjectsGrid(),this.initSearchSystem(),this.initTrendingTabs(),this.initFeaturedFirms(),this.initCategoryShowcase(),this.initLatestProducts(),this.initScrollAnimations(),this.bindEvents()},bindEvents:function(){r(".trending-tabs .tab").on("click",function(){var e=r(this).data("tab");r(".trending-tabs .tab").removeClass("active"),r(this).addClass("active"),r(".tab-content").removeClass("active").hide(),r("#"+e).addClass("active").fadeIn()}),r(".filter-btn").on("click",this.handleFilter.bind(this)),r(".load-more-btn").on("click",this.loadMoreItems.bind(this)),r(".hero-search input").on("focus",function(){r(".search-suggestions").slideDown()}).on("blur",function(){setTimeout(()=>{r(".search-suggestions").slideUp()},200)})},initHeroSlider:function(){r(".hero-slider").length&&new Swiper(".hero-slider",{slidesPerView:1,effect:"fade",speed:1e3,autoplay:{delay:5e3,disableOnInteraction:!1},pagination:{el:".swiper-pagination",clickable:!0,renderBullet:function(e,t){return`<span class="${t}"><span class="progress"></span></span>`}},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}).on("slideChange",function(){r(".swiper-pagination-bullet").removeClass("animate"),r(".swiper-pagination-bullet-active").addClass("animate")})},initProjectsGrid:function(){if(r(".projects-grid").length){let e=r(".projects-grid").masonry({itemSelector:".project-card",columnWidth:".project-card",percentPosition:!0,transitionDuration:"0.3s",initLayout:!1});e.imagesLoaded().progress(function(){e.masonry("layout")}),r(".project-card").hover(function(){r(this).find(".project-info").slideDown()},function(){r(this).find(".project-info").slideUp()})}},initSearchSystem:function(){this.initSearchModal(),this.initSearchEvents(),this.initKeyboardShortcuts(),this.initVoiceSearch(),this.initTypeahead()},initSearchModal:function(){r("body").append(`
                <div class="search-modal">
                    <div class="search-modal-content">
                        <div class="search-header">
                            <div class="search-input-wrapper">
                                <i class="fas fa-search"></i>
                                <input type="text" class="search-input" placeholder="搜索项目、产品或建筑师...">
                                <button class="voice-search-btn">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                            <button class="close-search-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="search-type-tabs">
                            <button class="type-tab active" data-type="all">全部</button>
                            <button class="type-tab" data-type="project">项目</button>
                            <button class="type-tab" data-type="product">产品</button>
                            <button class="type-tab" data-type="firm">建筑事务所</button>
                        </div>
                        <div class="search-results"></div>
                    </div>
                </div>
            `),this.$searchModal=r(".search-modal"),this.$searchInput=this.$searchModal.find(".search-input"),this.$searchResults=this.$searchModal.find(".search-results")},initSearchEvents:function(){r(".search-trigger, .hero-search").on("click",()=>{this.openSearchModal()}),r(".close-search-btn").on("click",()=>{this.closeSearchModal()}),r(".type-tab").on("click",function(){r(".type-tab").removeClass("active"),r(this).addClass("active"),this.performSearch()}.bind(this));let e;this.$searchInput.on("input",()=>{clearTimeout(e),e=setTimeout(()=>{this.performSearch()},300)})},initKeyboardShortcuts:function(){r(document).on("keydown",e=>{(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),this.openSearchModal()),"Escape"===e.key&&this.$searchModal.is(":visible")&&this.closeSearchModal()})},initVoiceSearch:function(){if("webkitSpeechRecognition"in window){let e=new webkitSpeechRecognition;e.continuous=!1,e.interimResults=!1,e.lang="zh-CN",r(".voice-search-btn").on("click",()=>{e.start(),r(".voice-search-btn").addClass("listening")}),e.onresult=e=>{this.$searchInput.val(e.results[0][0].transcript),this.performSearch()},e.onend=()=>{r(".voice-search-btn").removeClass("listening")}}else r(".voice-search-btn").hide()},initTypeahead:function(){this.$searchInput.on("input",function(){var e=r(this).val();2<=e.length&&this.fetchSuggestions(e)}.bind(this))},async performSearch(){var e=this.$searchInput.val(),t=r(".type-tab.active").data("type");if(e)try{var i=await r.ajax({url:architizer_ajax.ajax_url,data:{action:"perform_search",query:e,type:t,nonce:architizer_ajax.nonce}});i.success&&this.renderSearchResults(i.data)}catch(e){console.error("搜索失败:",e)}else this.showRecentSearches()},renderSearchResults:function(e){e.length?(e=e.map(e=>`
                <div class="search-result-item">
                    <div class="result-image">
                        <img src="${e.thumbnail}" alt="${e.title}">
                    </div>
                    <div class="result-info">
                        <h4>${e.title}</h4>
                        <p>${e.excerpt}</p>
                        <span class="result-type">${e.type}</span>
                    </div>
                </div>
            `).join(""),this.$searchResults.html(e)):this.$searchResults.html('<div class="no-results">未找到相关结果</div>')},initScrollAnimations:function(){let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animate"),t.unobserve(e.target))})},{threshold:.1});document.querySelectorAll(".animate-on-scroll").forEach(e=>{t.observe(e)})},initTrendingTabs:function(){r(".trending-tabs .tab").first().addClass("active"),r(".tab-content").first().addClass("active"),r(".tab-content").hide(),r(".tab-content.active").show()},initFeaturedFirms:function(){r(".featured-firms-slider").length&&new Swiper(".featured-firms-slider",{slidesPerView:1,spaceBetween:30,loop:!0,autoplay:{delay:3e3},breakpoints:{640:{slidesPerView:2},768:{slidesPerView:3},1024:{slidesPerView:4}}})},initCategoryShowcase:function(){r(".category-card").each(function(e){r(this).css({"animation-delay":.2*e+"s"})})},initLatestProducts:function(){r(".latest-products-slider").length&&new Swiper(".latest-products-slider",{slidesPerView:1,spaceBetween:20,loop:!0,autoplay:{delay:4e3},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{640:{slidesPerView:2},768:{slidesPerView:3},1024:{slidesPerView:4}}})},handleFilter:function(e){var e=r(e.currentTarget),t=e.data("filter");r(".filter-btn").removeClass("active"),e.addClass("active"),("all"===t?r(".grid-item"):(r(".grid-item").hide(),r(`.grid-item[data-category="${t}"]`))).show(),r(".projects-grid").length&&r(".projects-grid").masonry("layout")},loadMoreItems:async function(e){var e=r(e.currentTarget),t=e.closest("section").find(".grid"),i=e.data("page")||1;try{e.addClass("loading");var a,s=await r.ajax({url:architizer_ajax.ajax_url,data:{action:"load_more_items",page:i,type:e.data("type")}});s.success&&(a=r(s.data.html),t.append(a),e.data("page",i+1),s.data.has_more||e.hide(),t.hasClass("projects-grid"))&&t.masonry("appended",a)}catch(e){console.error("加载失败:",e)}finally{e.removeClass("loading")}}},r(document).ready(function(){r(".home").length&&Architizer.Home.init()})})(jQuery);class ImagePreview{constructor(){this.lightbox=this.createLightbox(),this.currentIndex=0,this.images=[],this.init()}createLightbox(){var e=document.createElement("div");return e.className="lightbox",e.innerHTML=`
            <div class="lightbox-content">
                <div class="lightbox-header">
                    <span class="image-counter"></span>
                    <div class="lightbox-controls">
                        <button class="zoom-in-btn" title="放大">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="zoom-out-btn" title="缩小">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="rotate-btn" title="旋转">
                            <i class="fas fa-redo"></i>
                        </button>
                        <button class="download-btn" title="下载">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="close-btn" title="关闭">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="lightbox-main">
                    <button class="nav-btn prev-btn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="image-container">
                        <img src="" alt="" class="preview-image">
                    </div>
                    <button class="nav-btn next-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="lightbox-footer">
                    <div class="image-caption"></div>
                    <div class="thumbnails-container"></div>
                </div>
            </div>
        `,document.body.appendChild(e),e}init(){this.initGalleryImages(),this.bindEvents(),this.initGestures()}initGalleryImages(){document.querySelectorAll(".project-thumbnail img, .product-thumbnail img").forEach(e=>{e.classList.add("preview-enabled"),e.addEventListener("click",e=>{var t=e.target.closest(".project-card, .product-card");t&&this.openGallery(t,e.target)})})}bindEvents(){this.lightbox.querySelector(".close-btn").addEventListener("click",()=>this.closeLightbox()),this.lightbox.querySelector(".prev-btn").addEventListener("click",()=>this.showPrevImage()),this.lightbox.querySelector(".next-btn").addEventListener("click",()=>this.showNextImage()),this.lightbox.querySelector(".zoom-in-btn").addEventListener("click",()=>this.zoomImage(1.2)),this.lightbox.querySelector(".zoom-out-btn").addEventListener("click",()=>this.zoomImage(.8)),this.lightbox.querySelector(".rotate-btn").addEventListener("click",()=>this.rotateImage()),this.lightbox.querySelector(".download-btn").addEventListener("click",()=>this.downloadImage()),document.addEventListener("keydown",e=>{if(this.lightbox.classList.contains("active"))switch(e.key){case"Escape":this.closeLightbox();break;case"ArrowLeft":this.showPrevImage();break;case"ArrowRight":this.showNextImage()}}),this.lightbox.addEventListener("click",e=>{e.target===this.lightbox&&this.closeLightbox()})}initGestures(){let t=0,i=0;this.lightbox.addEventListener("touchstart",e=>{t=e.changedTouches[0].screenX}),this.lightbox.addEventListener("touchend",e=>{i=e.changedTouches[0].screenX,this.handleGesture()})}openGallery(e,t){this.images=Array.from(e.querySelectorAll("img")).map(e=>({src:e.src,caption:e.alt||e.getAttribute("data-caption")||""})),this.currentIndex=this.images.findIndex(e=>e.src===t.src),this.showImage(this.currentIndex),this.lightbox.classList.add("active"),document.body.style.overflow="hidden",this.updateThumbnails()}showImage(e){var t=this.images[e],i=this.lightbox.querySelector(".preview-image"),a=this.lightbox.querySelector(".image-caption"),s=this.lightbox.querySelector(".image-counter");i.src=t.src,i.style.transform="scale(1) rotate(0deg)",a.textContent=t.caption,s.textContent=e+1+" / "+this.images.length,this.updateThumbnailSelection(e)}updateThumbnails(){var e=this.lightbox.querySelector(".thumbnails-container");e.innerHTML=this.images.map((e,t)=>`
            <div class="thumbnail ${t===this.currentIndex?"active":""}"
                 style="background-image: url('${e.src}')"
                 data-index="${t}">
            </div>
        `).join(""),e.querySelectorAll(".thumbnail").forEach(t=>{t.addEventListener("click",()=>{var e=parseInt(t.dataset.index);this.currentIndex=e,this.showImage(e)})})}updateThumbnailSelection(e){var t=this.lightbox.querySelectorAll(".thumbnail");t.forEach(e=>e.classList.remove("active")),t[e]?.classList.add("active")}showPrevImage(){this.currentIndex=(this.currentIndex-1+this.images.length)%this.images.length,this.showImage(this.currentIndex)}showNextImage(){this.currentIndex=(this.currentIndex+1)%this.images.length,this.showImage(this.currentIndex)}zoomImage(e){var t=this.lightbox.querySelector(".preview-image"),e=this.getImageScale(t)*e;.5<=e&&e<=3&&(t.style.transform=`scale(${e}) rotate(${this.getImageRotation(t)}deg)`)}rotateImage(){var e=this.lightbox.querySelector(".preview-image"),t=this.getImageRotation(e),i=this.getImageScale(e);e.style.transform=`scale(${i}) rotate(${t+90}deg)`}getImageScale(e){e=e.style.transform.match(/scale\((.*?)\)/);return e?parseFloat(e[1]):1}getImageRotation(e){e=e.style.transform.match(/rotate\((.*?)deg\)/);return e?parseFloat(e[1]):0}async downloadImage(){var e=this.images[this.currentIndex];try{var t=await(await fetch(e.src)).blob(),i=window.URL.createObjectURL(t),a=document.createElement("a");a.href=i,a.download=`image-${this.currentIndex+1}.jpg`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(i)}catch(e){console.error("下载失败:",e)}}closeLightbox(){this.lightbox.classList.remove("active"),document.body.style.overflow=""}}let lightboxStyles=document.createElement("style");lightboxStyles.textContent=`
    .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: none;
        z-index: 1000;
    }

    .lightbox.active {
        display: flex;
    }

    .lightbox-content {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .lightbox-header {
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #fff;
    }

    .lightbox-controls {
        display: flex;
        gap: 10px;
    }

    .lightbox-controls button {
        background: none;
        border: none;
        color: #fff;
        cursor: pointer;
        padding: 8px;
        border-radius: 4px;
        transition: background-color 0.3s ease;
    }

    .lightbox-controls button:hover {
        background: rgba(255,255,255,0.1);
    }

    .lightbox-main {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .image-container {
        max-width: 90%;
        max-height: 80vh;
        position: relative;
    }

    .preview-image {
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
        transition: transform 0.3s ease;
    }

    .nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0,0,0,0.5);
        border: none;
        color: #fff;
        padding: 15px;
        cursor: pointer;
        border-radius: 50%;
        transition: background-color 0.3s ease;
    }

    .prev-btn {
        left: 20px;
    }

    .next-btn {
        right: 20px;
    }

    .nav-btn:hover {
        background: rgba(0,0,0,0.8);
    }

    .lightbox-footer {
        padding: 15px;
        color: #fff;
        text-align: center;
    }

    .thumbnails-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 15px;
        overflow-x: auto;
        padding: 10px 0;
    }

    .thumbnail {
        width: 60px;
        height: 60px;
        background-size: cover;
        background-position: center;
        cursor: pointer;
        border: 2px solid transparent;
        border-radius: 4px;
        transition: all 0.3s ease;
    }

    .thumbnail.active {
        border-color: #fff;
    }

    .preview-enabled {
        cursor: pointer;
        transition: opacity 0.3s ease;
    }

    .preview-enabled:hover {
        opacity: 0.8;
    }

    @media (max-width: 768px) {
        .lightbox-controls {
            display: none;
        }

        .nav-btn {
            padding: 10px;
        }

        .thumbnail {
            width: 40px;
            height: 40px;
        }
    }
`,document.head.appendChild(lightboxStyles),document.addEventListener("DOMContentLoaded",()=>{new ImagePreview});class InteractionEffects{constructor(){this.init()}init(){this.initScrollAnimations(),this.initHoverEffects(),this.initParallaxEffects(),this.initImageLazyLoad(),this.initSmoothScroll()}initScrollAnimations(){let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("animate-in"),t.unobserve(e.target))})},{root:null,rootMargin:"0px",threshold:.1});document.querySelectorAll(".project-card, .product-card, .section-title, .filter-group").forEach(e=>{e.classList.add("animate-item"),t.observe(e)})}initHoverEffects(){document.querySelectorAll(".project-card, .product-card").forEach(e=>{e.addEventListener("mouseenter",this.handleCardHover),e.addEventListener("mouseleave",this.handleCardLeave)}),document.querySelectorAll(".filter-submit, .load-more-btn").forEach(e=>{e.addEventListener("mouseenter",this.handleButtonHover),e.addEventListener("mouseleave",this.handleButtonLeave)})}handleCardHover(e){var e=e.currentTarget,t=e.querySelector(".project-thumbnail img, .product-thumbnail img");t&&(t.style.transform="scale(1.1)",t.style.transition="transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)"),e.style.transform="translateY(-8px)",e.style.boxShadow="0 12px 24px rgba(0,0,0,0.15)"}handleCardLeave(e){var e=e.currentTarget,t=e.querySelector(".project-thumbnail img, .product-thumbnail img");t&&(t.style.transform="scale(1)"),e.style.transform="translateY(0)",e.style.boxShadow="0 2px 10px rgba(0,0,0,0.1)"}handleButtonHover(e){e.currentTarget.style.transform="translateY(-2px)",this.createButtonRipple(e)}handleButtonLeave(e){e.currentTarget.style.transform="translateY(0)"}createButtonRipple(e){var t=e.currentTarget;let i=document.createElement("span");var a=t.getBoundingClientRect(),s=Math.max(a.width,a.height),r=e.clientX-a.left-s/2,e=e.clientY-a.top-s/2;i.style.width=i.style.height=s+"px",i.style.left=r+"px",i.style.top=e+"px",i.classList.add("ripple"),t.appendChild(i),i.addEventListener("animationend",()=>{i.remove()})}initParallaxEffects(){window.addEventListener("scroll",()=>{requestAnimationFrame(()=>{document.querySelectorAll(".parallax-bg").forEach(e=>{var t=window.pageYOffset;e.style.transform=`translate3d(0, ${-.3*t}px, 0)`})})})}initImageLazyLoad(){let t=new IntersectionObserver((e,i)=>{e.forEach(e=>{var t;e.isIntersecting&&(t=(e=e.target).dataset.src)&&(e.src=t,e.classList.add("fade-in"),i.unobserve(e))})});document.querySelectorAll("img[data-src]").forEach(e=>{t.observe(e)})}initSmoothScroll(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=t.getAttribute("href"),e=document.querySelector(e);e&&e.scrollIntoView({behavior:"smooth",block:"start"})})})}}let interactionStyles=document.createElement("style");interactionStyles.textContent=`
    .animate-item {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .animate-in {
        opacity: 1;
        transform: translateY(0);
    }

    .fade-in {
        animation: fadeIn 0.5s ease forwards;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255,255,255,0.4);
        transform: scale(0);
        animation: ripple 0.6s linear;
        pointer-events: none;
    }

    @keyframes ripple {
        to {
            transform: scale(4);
            opacity: 0;
        }
    }

    .project-card,
    .product-card {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .project-thumbnail img,
    .product-thumbnail img {
        transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .filter-submit,
    .load-more-btn {
        position: relative;
        overflow: hidden;
        transition: transform 0.3s ease, background-color 0.3s ease;
    }

    .parallax-bg {
        will-change: transform;
    }
`,document.head.appendChild(interactionStyles),document.addEventListener("DOMContentLoaded",()=>{new InteractionEffects});class PerformanceMonitor{constructor(){this.metrics={},this.init()}init(){this.observePageLoad(),this.observeUserInteractions(),this.observeNetworkRequests()}observePageLoad(){window.addEventListener("load",()=>{var e=performance.timing,t=e.navigationStart;this.metrics.pageLoad={total:e.loadEventEnd-t,ttfb:e.responseStart-t,domReady:e.domContentLoadedEventEnd-t,resources:e.loadEventEnd-e.domContentLoadedEventEnd},this.sendMetrics("pageLoad")}),performance.getEntriesByType("paint").forEach(e=>{this.metrics[e.name]=e.startTime})}observeUserInteractions(){let i=performance.now();document.addEventListener("click",()=>{var e=performance.now(),t=e-i;this.metrics.interactionDelay=t,i=e,this.sendMetrics("interaction")},!0)}observeNetworkRequests(){new PerformanceObserver(e=>{e.getEntries().forEach(e=>{"xmlhttprequest"!==e.initiatorType&&"fetch"!==e.initiatorType||(this.metrics.apiCalls=this.metrics.apiCalls||[],this.metrics.apiCalls.push({name:e.name,duration:e.duration,size:e.transferSize}))})}).observe({entryTypes:["resource"]})}sendMetrics(e){e&&this.metrics[e]&&fetch("/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"log_performance",metrics:JSON.stringify(this.metrics[e]),type:e})})}}window.isBot||new PerformanceMonitor;class SocialShare{constructor(){this.shareData={title:document.title,url:window.location.href,description:this.getMetaDescription(),image:this.getShareImage()},this.platforms={weixin:{name:"微信",icon:"fab fa-weixin",action:()=>this.shareWeixin()},weibo:{name:"微博",icon:"fab fa-weibo",action:()=>this.shareWeibo()},qzone:{name:"QQ空间",icon:"fab fa-qq",action:()=>this.shareQzone()},linkedin:{name:"LinkedIn",icon:"fab fa-linkedin",action:()=>this.shareLinkedin()},copyLink:{name:"复制链接",icon:"fas fa-link",action:()=>this.copyLink()}},this.init()}init(){this.createShareButtons(),this.initShareModal(),this.initQRCode()}getMetaDescription(){var e=document.querySelector('meta[name="description"]');return e?e.getAttribute("content"):""}getShareImage(){var e=document.querySelector('meta[property="og:image"]');return e?e.getAttribute("content"):""}createShareButtons(){document.querySelectorAll(".share-trigger").forEach(e=>{let a=document.createElement("div");a.className="share-container",Object.entries(this.platforms).forEach(([e,t])=>{var i=document.createElement("button");i.className="share-button "+e,i.innerHTML=`<i class="${t.icon}"></i><span>${t.name}</span>`,i.addEventListener("click",e=>{e.preventDefault(),t.action()}),a.appendChild(i)}),e.appendChild(a)})}initShareModal(){this.modal=document.createElement("div"),this.modal.className="share-modal",this.modal.innerHTML=`
            <div class="share-modal-content">
                <div class="share-modal-header">
                    <h3>分享到</h3>
                    <button class="close-modal"><i class="fas fa-times"></i></button>
                </div>
                <div class="share-modal-body">
                    <div class="qrcode-container">
                        <div id="share-qrcode"></div>
                        <p>微信扫码分享</p>
                    </div>
                    <div class="share-preview">
                        <div class="preview-image">
                            <img src="${this.shareData.image||""}" alt="分享预览图">
                        </div>
                        <div class="preview-content">
                            <h4>${this.shareData.title}</h4>
                            <p>${this.shareData.description}</p>
                        </div>
                    </div>
                </div>
            </div>
        `,document.body.appendChild(this.modal),this.modal.querySelector(".close-modal").addEventListener("click",()=>{this.modal.classList.remove("active")}),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.modal.classList.remove("active")})}initQRCode(){"undefined"!=typeof QRCode&&new QRCode(document.getElementById("share-qrcode"),{text:this.shareData.url,width:128,height:128})}shareWeixin(){this.modal.classList.add("active")}shareWeibo(){var e=new URLSearchParams({url:this.shareData.url,title:this.shareData.title,pic:this.shareData.image});window.open("http://service.weibo.com/share/share.php?"+e.toString(),"_blank","width=600,height=500")}shareQzone(){var e=new URLSearchParams({url:this.shareData.url,title:this.shareData.title,desc:this.shareData.description,pics:this.shareData.image});window.open("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?"+e.toString(),"_blank","width=600,height=500")}shareLinkedin(){var e=new URLSearchParams({url:this.shareData.url,title:this.shareData.title,summary:this.shareData.description});window.open("https://www.linkedin.com/shareArticle?mini=true&"+e.toString(),"_blank","width=600,height=500")}async copyLink(){try{await navigator.clipboard.writeText(this.shareData.url),this.showToast("链接已复制到剪贴板")}catch(e){this.showToast("复制失败，请手动复制")}}showToast(e){let t=document.createElement("div");t.className="share-toast",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.classList.add("show")},100),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{document.body.removeChild(t)},300)},2e3)}}let shareStyles=document.createElement("style");shareStyles.textContent=`
    .share-container {
        display: flex;
        gap: 10px;
        margin: 15px 0;
    }

    .share-button {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: #f5f5f5;
    }

    .share-button:hover {
        background: #e5e5e5;
    }

    .share-button i {
        font-size: 16px;
    }

    .share-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .share-modal.active {
        display: flex;
    }

    .share-modal-content {
        background: #fff;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        padding: 20px;
    }

    .share-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .close-modal {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 20px;
        color: #666;
    }

    .qrcode-container {
        text-align: center;
        margin-bottom: 20px;
    }

    .share-preview {
        border: 1px solid #eee;
        border-radius: 4px;
        padding: 10px;
        display: flex;
        gap: 15px;
    }

    .preview-image img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 4px;
    }

    .preview-content h4 {
        margin: 0 0 10px;
        font-size: 16px;
    }

    .preview-content p {
        margin: 0;
        color: #666;
        font-size: 14px;
    }

    .share-toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(100%);
        background: rgba(0,0,0,0.8);
        color: #fff;
        padding: 10px 20px;
        border-radius: 4px;
        transition: transform 0.3s ease;
    }

    .share-toast.show {
        transform: translateX(-50%) translateY(0);
    }

    @media (max-width: 768px) {
        .share-container {
            flex-wrap: wrap;
        }

        .share-button {
            flex: 1;
            min-width: 100px;
        }

        .preview-image img {
            width: 60px;
            height: 60px;
        }
    }
`,document.head.appendChild(shareStyles),document.addEventListener("DOMContentLoaded",()=>{new SocialShare}),jQuery(document).ready(function(r){r(".wp-architizer-options .color-field").wpColorPicker(),r(".image-upload-button").click(function(e){e.preventDefault();var i=r(this),a=i.siblings("input"),s=wp.media({title:"选择图片",library:{type:"image"},button:{text:"使用此图片"},multiple:!1}).on("select",function(){var e=s.state().get("selection").first().toJSON(),t=(a.val(e.url),i.siblings("img"));(t=0===t.length?r('<img style="max-width:200px;">').insertBefore(a):t).attr("src",e.url)}).open()}),r("form").on("submit",function(e){var t=r("#custom_css").val(),i=r("#custom_js").val();return t&&!(e=>{try{return(new CSSStyleSheet).insertRule(e,0),1}catch(e){}})(t)?(e.preventDefault(),alert("自定义CSS格式不正确"),!1):i&&!(e=>{try{return new Function(e),1}catch(e){}})(i)?(e.preventDefault(),alert("自定义JavaScript格式不正确"),!1):void 0})});class AdvancedSearch{constructor(){this.searchModal=null,this.searchInput=null,this.searchResults=null,this.searchTimeout=null,this.recentSearches=[],this.init()}init(){this.createSearchModal(),this.loadRecentSearches(),this.initSearchTrigger(),this.initSearchEvents(),this.initKeyboardShortcuts(),this.initVoiceSearch()}createSearchModal(){document.body.insertAdjacentHTML("beforeend",`
            <div class="search-modal">
                <div class="search-modal-content">
                    <div class="search-header">
                        <div class="search-input-wrapper">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" placeholder="搜索项目、产品或建筑师...">
                            <button class="voice-search-btn" title="语音搜索">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                        <button class="close-search-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-filters">
                        <div class="filter-tags">
                            <button class="filter-tag active" data-type="all">全部</button>
                            <button class="filter-tag" data-type="project">项目</button>
                            <button class="filter-tag" data-type="product">产品</button>
                            <button class="filter-tag" data-type="firm">建筑事务所</button>
                        </div>
                    </div>
                    <div class="search-results">
                        <div class="recent-searches">
                            <h3>最近搜索</h3>
                            <ul class="recent-list"></ul>
                        </div>
                        <div class="live-results"></div>
                    </div>
                </div>
            </div>
        `),this.searchModal=document.querySelector(".search-modal"),this.searchInput=this.searchModal.querySelector(".search-input"),this.searchResults=this.searchModal.querySelector(".search-results")}initSearchTrigger(){document.querySelectorAll(".search-trigger, .hero-search").forEach(e=>{e.addEventListener("click",()=>this.openSearch())})}initSearchEvents(){this.searchModal.querySelector(".close-search-btn").addEventListener("click",()=>{this.closeSearch()}),this.searchInput.addEventListener("input",()=>{clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{var e=this.searchInput.value;2<=e.length?this.performSearch(e):this.showRecentSearches()},300)}),this.searchModal.querySelectorAll(".filter-tag").forEach(e=>{e.addEventListener("click",()=>{this.searchModal.querySelectorAll(".filter-tag").forEach(e=>{e.classList.remove("active")}),e.classList.add("active"),this.searchInput.value&&this.performSearch(this.searchInput.value)})}),this.searchModal.addEventListener("click",e=>{e.target===this.searchModal&&this.closeSearch()})}async performSearch(e){try{var t=this.searchModal.querySelector(".filter-tag.active").dataset.type,i=await(await fetch(wpAjax.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"perform_search",nonce:wpAjax.nonce,query:e,type:t})})).json();i.success&&(this.renderSearchResults(i.data),this.addToRecentSearches(e))}catch(e){console.error("搜索失败:",e)}}renderSearchResults(e){var t=this.searchModal.querySelector(".live-results");e.length?(e=e.map(e=>`
            <a href="${e.url}" class="search-result-item">
                <div class="result-thumbnail">
                    <img src="${e.thumbnail}" alt="${e.title}">
                </div>
                <div class="result-content">
                    <h4>
                        ${e.title}
                        <span class="result-type">${e.type}</span>
                    </h4>
                    <p>${e.excerpt}</p>
                </div>
            </a>
        `).join(""),t.innerHTML=e):t.innerHTML='<div class="no-results">未找到相关结果</div>'}openSearch(){this.searchModal.classList.add("active"),this.searchInput.focus(),document.body.style.overflow="hidden",this.showRecentSearches()}closeSearch(){this.searchModal.classList.remove("active"),document.body.style.overflow=""}loadRecentSearches(){this.recentSearches=JSON.parse(localStorage.getItem("recentSearches")||"[]")}addToRecentSearches(e){this.recentSearches.includes(e)||(this.recentSearches.unshift(e),5<this.recentSearches.length&&this.recentSearches.pop(),localStorage.setItem("recentSearches",JSON.stringify(this.recentSearches)))}}document.addEventListener("DOMContentLoaded",()=>{window.advancedSearch=new AdvancedSearch});class AjaxLoadMore{constructor(){this.grid=document.querySelector(".projects-grid, .products-grid"),this.loadMoreBtn=document.querySelector(".load-more-btn"),this.loading=!1,this.page=1,this.init()}init(){this.loadMoreBtn&&this.loadMoreBtn.addEventListener("click",e=>{e.preventDefault(),this.loadMore()}),this.initInfiniteScroll(),this.initFilters()}initInfiniteScroll(){var e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!this.loading&&this.loadMore()})},{root:null,rootMargin:"0px",threshold:.1});this.loadMoreBtn&&e.observe(this.loadMoreBtn)}initFilters(){var e=document.querySelector(".filters-form");e&&e.addEventListener("submit",e=>{e.preventDefault(),this.page=1,this.grid.innerHTML="",this.loadMore(!0)})}async loadMore(e=!1){if(!this.loading){this.loading=!0,this.showLoading();var t=new FormData,a=(t.append("action","load_more_posts"),t.append("nonce",wpAjax.nonce),t.append("page",this.page),t.append("post_type",wpAjax.postType),wpAjax.taxonomy&&(t.append("taxonomy",wpAjax.taxonomy),t.append("term_id",wpAjax.termId)),document.querySelector(".filters-form"));if(a){let i={};new FormData(a).forEach((e,t)=>{i[t]=e}),t.append("filters",JSON.stringify(i))}try{var i=await(await fetch(wpAjax.ajaxUrl,{method:"POST",body:t})).json();i.success&&(e?this.grid.innerHTML=i.posts:this.grid.insertAdjacentHTML("beforeend",i.posts),i.has_more||(this.loadMoreBtn.style.display="none"),this.page++)}catch(e){console.error("加载失败:",e)}finally{this.loading=!1,this.hideLoading()}}}showLoading(){this.loadMoreBtn&&(this.loadMoreBtn.classList.add("loading"),this.loadMoreBtn.textContent="加载中...")}hideLoading(){this.loadMoreBtn&&(this.loadMoreBtn.classList.remove("loading"),this.loadMoreBtn.textContent="加载更多")}}document.addEventListener("DOMContentLoaded",()=>{new AjaxLoadMore});class ContactForm{constructor(e){this.wrapper=e,this.form=this.wrapper.querySelector(".contact-form"),this.submitButton=this.form.querySelector(".submit-button"),this.successMessage=this.wrapper.querySelector(".success-message"),this.errorMessage=this.wrapper.querySelector(".error-message"),this.init()}init(){this.form.addEventListener("submit",this.handleSubmit.bind(this));var e=this.form.querySelector('input[type="file"]');e&&e.addEventListener("change",this.handleFileSelect.bind(this)),this.form.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("invalid",this.handleInvalid.bind(this)),e.addEventListener("input",this.handleInput.bind(this))})}async handleSubmit(e){e.preventDefault(),this.submitButton.disabled=!0,this.submitButton.textContent="提交中...";e=new FormData(this.form);e.append("action","submit_contact_form"),e.append("nonce",this.form.querySelector('[name="contact_form_nonce"]').value);try{var t=await(await fetch(ajaxurl,{method:"POST",body:e})).json();t.success?(this.showSuccess(t.data),this.form.reset()):this.showError(t.data)}catch(e){this.showError("提交失败，请稍后重试")}finally{this.submitButton.disabled=!1,this.submitButton.textContent="提交"}}handleFileSelect(e){var t=e.target.files[0];2097152<t.size?(e.target.value="",this.showError("文件大小不能超过2MB")):["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(t.type)||(e.target.value="",this.showError("不支持的文件类型"))}handleInvalid(e){e.preventDefault();var e=e.target,t=(e.classList.add("invalid"),e.getAttribute("data-error")||"请填写此字段");let i=e.parentElement.querySelector(".field-error");i||((i=document.createElement("div")).className="field-error",e.parentElement.appendChild(i)),i.textContent=t}handleInput(e){e=e.target,e.classList.remove("invalid"),e=e.parentElement.querySelector(".field-error");e&&e.remove()}showSuccess(e){this.successMessage.textContent=e,this.successMessage.style.display="block",this.errorMessage.style.display="none",setTimeout(()=>{this.successMessage.style.display="none"},5e3)}showError(e){this.errorMessage.textContent=e,this.errorMessage.style.display="block",this.successMessage.style.display="none",setTimeout(()=>{this.errorMessage.style.display="none"},5e3)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".contact-form-wrapper").forEach(e=>{new ContactForm(e)}),document.querySelectorAll(".contact-map").forEach(e=>{var t=parseFloat(e.dataset.latitude),i=parseFloat(e.dataset.longitude);t&&i&&(e=new google.maps.Map(e,{center:{lat:t,lng:i},zoom:15}),new google.maps.Marker({position:{lat:t,lng:i},map:e}))})});class FilterEnhancement{constructor(){this.filterForm=document.querySelector(".filters-form"),this.filterInputs=document.querySelectorAll(".filter-input, .filter-select"),this.activeFilters=document.querySelector(".active-filters"),this.debounceTimer=null,this.init()}init(){this.initializeFilterState(),this.bindEvents(),this.createActiveFiltersDisplay()}initializeFilterState(){this.filterState=new URLSearchParams(window.location.search),this.updateActiveFiltersDisplay()}bindEvents(){this.filterInputs.forEach(e=>{"INPUT"===e.tagName?e.addEventListener("input",()=>this.debounceFilter(e)):e.addEventListener("change",()=>this.handleFilterChange(e))}),document.addEventListener("click",e=>{e.target.classList.contains("clear-filter")&&(e.preventDefault(),e=e.target.dataset.filter,this.clearFilter(e))});var e=document.querySelector(".clear-all-filters");e&&e.addEventListener("click",e=>{e.preventDefault(),this.clearAllFilters()})}debounceFilter(e){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.handleFilterChange(e)},500)}handleFilterChange(e){var t=e.value.trim(),e=e.name;t?this.filterState.set(e,t):this.filterState.delete(e),this.updateURL(),this.updateActiveFiltersDisplay(),this.triggerFilterUpdate()}clearFilter(e){this.filterState.delete(e);e=this.filterForm.querySelector(`[name="${e}"]`);e&&(e.value=""),this.updateURL(),this.updateActiveFiltersDisplay(),this.triggerFilterUpdate()}clearAllFilters(){this.filterState=new URLSearchParams,this.filterInputs.forEach(e=>{e.value=""}),this.updateURL(),this.updateActiveFiltersDisplay(),this.triggerFilterUpdate()}updateURL(){var e=""+window.location.pathname+(this.filterState.toString()?"?"+this.filterState.toString():"");window.history.pushState({},"",e)}createActiveFiltersDisplay(){this.activeFilters||(this.activeFilters=document.createElement("div"),this.activeFilters.className="active-filters",this.filterForm.insertAdjacentElement("afterend",this.activeFilters))}updateActiveFiltersDisplay(){if(this.activeFilters){let i={project_year:"年份",project_location:"位置",manufacturer:"制造商",price_range:"价格区间",orderby:"排序"},a="",s=!1;this.filterState.forEach((e,t)=>{e&&(s=!0,a+=`
                    <span class="active-filter">
                        ${i[t]||t}: ${e}
                        <button class="clear-filter" data-filter="${t}">
                            <i class="fas fa-times"></i>
                        </button>
                    </span>
                `)}),s&&(a=`
                <div class="active-filters-wrapper">
                    <span class="active-filters-label">当前筛选：</span>
                    ${a}
                    <button class="clear-all-filters">清除所有</button>
                </div>
            `),this.activeFilters.innerHTML=a,this.animateFilterChanges()}}animateFilterChanges(){document.querySelectorAll(".active-filter").forEach((e,t)=>{e.style.animation=`fadeInSlide 0.3s ease forwards ${.1*t}s`})}triggerFilterUpdate(){var e=new CustomEvent("filterUpdate",{detail:{filters:Object.fromEntries(this.filterState)}});document.dispatchEvent(e)}}let style=document.createElement("style");function initProductGallery(){var e;document.querySelector(".gallery-main-slider")&&(e=new Swiper(".gallery-thumbs-slider",{spaceBetween:10,slidesPerView:4,freeMode:!0,watchSlidesVisibility:!0,watchSlidesProgress:!0,breakpoints:{768:{slidesPerView:5},1024:{slidesPerView:6}}}),new Swiper(".gallery-main-slider",{spaceBetween:10,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},thumbs:{swiper:e}}))}function initProductInteractions(){var e=document.querySelector(".share-btn");e&&e.addEventListener("click",function(){navigator.share&&navigator.share({title:document.title,url:window.location.href})}),document.querySelectorAll(".specs-filter button").forEach(e=>{e.addEventListener("click",function(){filterSpecifications(this.dataset.category)})})}function initDocumentDownload(){document.querySelectorAll(".document-download").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=this.href;let i=this.dataset.filename;showDownloadProgress(),fetch(e).then(e=>e.blob()).then(e=>{var t=document.createElement("a");t.href=window.URL.createObjectURL(e),t.download=i,t.click(),hideDownloadProgress()})})})}function filterSpecifications(t){document.querySelectorAll(".specs-table tr").forEach(e=>{"all"===t||e.dataset.category===t?e.style.display="":e.style.display="none"})}function showDownloadProgress(){}function hideDownloadProgress(){}style.textContent=`
    @keyframes fadeInSlide {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .active-filters-wrapper {
        margin: 20px 0;
        padding: 15px;
        background: #f5f5f5;
        border-radius: 8px;
        animation: fadeIn 0.3s ease;
    }

    .active-filters-label {
        color: #666;
        margin-right: 10px;
    }

    .active-filter {
        display: inline-flex;
        align-items: center;
        margin: 0 10px 10px 0;
        padding: 5px 10px;
        background: #fff;
        border-radius: 20px;
        font-size: 14px;
        opacity: 0;
    }

    .clear-filter {
        background: none;
        border: none;
        color: #666;
        margin-left: 5px;
        cursor: pointer;
        padding: 2px;
    }

    .clear-filter:hover {
        color: #ff4444;
    }

    .clear-all-filters {
        background: none;
        border: none;
        color: #666;
        text-decoration: underline;
        cursor: pointer;
        margin-left: 15px;
    }

    .clear-all-filters:hover {
        color: #333;
    }
`,document.head.appendChild(style),document.addEventListener("DOMContentLoaded",()=>{new FilterEnhancement}),document.addEventListener("DOMContentLoaded",function(){initProductGallery(),initProductInteractions(),initDocumentDownload()});class Navigation{constructor(){this.header=document.querySelector(".site-header"),this.mobileMenu=document.querySelector(".mobile-menu"),this.menuTrigger=document.querySelector(".mobile-menu-trigger"),this.closeMenu=document.querySelector(".close-menu"),this.lastScrollTop=0,this.init()}init(){this.menuTrigger?.addEventListener("click",()=>this.toggleMobileMenu()),this.closeMenu?.addEventListener("click",()=>this.toggleMobileMenu()),window.addEventListener("scroll",()=>this.handleScroll()),document.querySelectorAll(".menu-item-has-children").forEach(t=>{var e=document.createElement("button");e.className="submenu-toggle",e.innerHTML='<i class="fas fa-chevron-down"></i>',t.appendChild(e),e.addEventListener("click",e=>{e.preventDefault(),t.classList.toggle("submenu-open")})})}toggleMobileMenu(){this.mobileMenu.classList.toggle("active"),document.body.classList.toggle("menu-open")}handleScroll(){var e=window.pageYOffset||document.documentElement.scrollTop;e>this.lastScrollTop&&100<e?this.header.classList.add("header-hidden"):this.header.classList.remove("header-hidden"),this.lastScrollTop=e}}document.addEventListener("DOMContentLoaded",()=>{new Navigation});class PerformanceManager{constructor(){this.initializeElements(),this.bindEvents(),this.loadStats()}initializeElements(){this.optimizeImagesBtn=document.getElementById("optimize-images"),this.clearCacheBtn=document.getElementById("clear-cache"),this.progressBar=document.querySelector(".progress-bar .progress"),this.logContainer=document.querySelector(".optimization-log")}bindEvents(){this.optimizeImagesBtn&&this.optimizeImagesBtn.addEventListener("click",()=>this.handleImageOptimization()),this.clearCacheBtn&&this.clearCacheBtn.addEventListener("click",()=>this.handleCacheClear()),document.querySelectorAll(".performance-settings input").forEach(e=>{e.addEventListener("change",()=>this.handleSettingChange(e))})}async loadStats(){try{var e=await(await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_performance_stats",nonce:performanceSettings.nonce})})).json();e.success&&this.updateStats(e.data)}catch(e){console.error("加载性能统计失败:",e)}}updateStats(e){Object.entries(e).forEach(([e,t])=>{e=document.querySelector(`[data-stat="${e}"]`);e&&(e.textContent=t)})}async handleImageOptimization(){this.optimizeImagesBtn.disabled=!0,this.progressBar.style.width="0%";try{var t,i=await this.getUnoptimizedImages();let e=0;for(t of i)await this.optimizeImage(t),e++,this.updateProgress(e/i.length*100),this.log("优化图片: "+t.filename,"success");this.log("所有图片优化完成!","success")}catch(e){this.log("优化失败: "+e.message,"error")}finally{this.optimizeImagesBtn.disabled=!1}}async handleCacheClear(){this.clearCacheBtn.disabled=!0;try{var e=await(await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"clear_all_cache",nonce:performanceSettings.nonce})})).json();if(!e.success)throw new Error(e.data);this.log("缓存清理成功!","success")}catch(e){this.log("清理缓存失败: "+e.message,"error")}finally{this.clearCacheBtn.disabled=!1}}async handleSettingChange(t){var e=t.name,i="checkbox"===t.type?t.checked:t.value;try{var a=await(await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"update_performance_setting",nonce:performanceSettings.nonce,setting:e,value:i})})).json();if(!a.success)throw new Error(a.data);this.log("设置已更新: "+e,"success")}catch(e){this.log("更新设置失败: "+e.message,"error"),t.checked=!t.checked}}updateProgress(e){this.progressBar.style.width=e+"%"}log(e,t="info"){var i=document.createElement("div");i.className="log-entry "+t,i.textContent=`[${(new Date).toLocaleTimeString()}] `+e,this.logContainer.insertBefore(i,this.logContainer.firstChild),100<this.logContainer.children.length&&this.logContainer.removeChild(this.logContainer.lastChild)}async getUnoptimizedImages(){var e=await(await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"get_unoptimized_images",nonce:performanceSettings.nonce})})).json();if(e.success)return e.data;throw new Error(e.data)}async optimizeImage(e){e=await(await fetch(ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"optimize_single_image",nonce:performanceSettings.nonce,image_id:e.id})})).json();if(e.success)return e.data;throw new Error(e.data)}}document.addEventListener("DOMContentLoaded",()=>{new PerformanceManager});class ProductGallery{constructor(){this.mainContainer=document.querySelector(".gallery-main"),this.thumbsContainer=document.querySelector(".gallery-thumbs"),this.mainItems=document.querySelectorAll(".gallery-main-item"),this.thumbs=document.querySelectorAll(".gallery-thumb"),this.currentIndex=0,this.init()}init(){this.mainItems.length&&(this.setActiveItem(0),this.bindEvents(),this.addTouchSupport(),this.addKeyboardSupport())}bindEvents(){this.thumbs.forEach((e,t)=>{e.addEventListener("click",()=>this.setActiveItem(t))}),this.mainItems.forEach(e=>{e.addEventListener("click",()=>this.openLightbox(e))})}setActiveItem(e){this.currentIndex=e,this.mainItems.forEach(e=>e.classList.remove("active")),this.thumbs.forEach(e=>e.classList.remove("active")),this.mainItems[e].classList.add("active"),this.thumbs[e].classList.add("active"),this.scrollThumbIntoView(e)}scrollThumbIntoView(e){this.thumbs[e].scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})}addTouchSupport(){let t=0,i=!1;this.mainContainer.addEventListener("touchstart",e=>{t=e.touches[0].clientX,i=!0}),this.mainContainer.addEventListener("touchmove",e=>{i&&(e=e.touches[0].clientX,e=t-e,50<Math.abs(e))&&(0<e&&this.currentIndex<this.mainItems.length-1?this.setActiveItem(this.currentIndex+1):e<0&&0<this.currentIndex&&this.setActiveItem(this.currentIndex-1),i=!1)})}addKeyboardSupport(){document.addEventListener("keydown",e=>{"ArrowLeft"===e.key&&0<this.currentIndex?this.setActiveItem(this.currentIndex-1):"ArrowRight"===e.key&&this.currentIndex<this.mainItems.length-1&&this.setActiveItem(this.currentIndex+1)})}openLightbox(e){}}document.addEventListener("DOMContentLoaded",()=>{new ProductGallery});class BasicSearch{constructor(){this.init()}init(){this.searchForm=document.querySelector(".search-form"),this.searchForm&&(this.searchType=this.searchForm.querySelector(".search-type"),this.advancedToggle=this.searchForm.querySelector(".toggle-button"),this.advancedFields=this.searchForm.querySelector(".advanced-search-fields"),this.filterGroups=this.searchForm.querySelectorAll(".filter-group"),this.bindEvents())}bindEvents(){this.searchForm.addEventListener("submit",e=>{e.preventDefault(),this.performBasicSearch()}),this.advancedToggle&&this.advancedToggle.addEventListener("click",()=>{this.toggleAdvancedSearch()}),this.searchType&&this.searchType.addEventListener("change",()=>{this.handleTypeChange()})}toggleAdvancedSearch(){this.advancedFields.style.display="none"===this.advancedFields.style.display?"block":"none"}handleTypeChange(){var e=this.searchType.value;this.filterGroups.forEach(e=>{e.style.display="none"}),"all"!==e&&(e=this.searchForm.querySelector(`.${e}-filters`))&&(e.style.display="grid")}async performBasicSearch(){var e=new FormData(this.searchForm);try{var t=await(await fetch(wpAjax.ajaxUrl,{method:"POST",body:e})).json();t.success&&(window.location.href=t.redirect)}catch(e){console.error("搜索失败:",e)}}}document.addEventListener("DOMContentLoaded",()=>{new BasicSearch});class SEOPreview{constructor(){this.titleInput=document.getElementById("seo_title"),this.descriptionInput=document.getElementById("seo_description"),this.previewTitle=document.querySelector(".preview-title"),this.previewUrl=document.querySelector(".preview-url"),this.previewDescription=document.querySelector(".preview-description"),this.init()}init(){this.titleInput&&this.descriptionInput&&(this.titleInput.addEventListener("input",()=>this.updatePreview()),this.descriptionInput.addEventListener("input",()=>this.updatePreview()),this.updatePreview())}updatePreview(){var e=this.titleInput.value||document.getElementById("title").value,t=this.descriptionInput.value,i=window.location.origin+"/"+document.getElementById("post_name").value;this.previewTitle.textContent=e,this.previewUrl.textContent=i,this.previewDescription.textContent=t,this.updateCharacterCount(this.titleInput,60),this.updateCharacterCount(this.descriptionInput,160)}updateCharacterCount(e,t){var i,a=e.value.length,s=e.nextElementSibling.querySelector(".char-count");s||((i=document.createElement("span")).className="char-count",e.nextElementSibling.appendChild(i)),s.textContent=a+"/"+t,s.style.color=t<a?"#e74c3c":"#666"}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".wp-architizer-seo-meta")&&new SEOPreview});class SocialShare{constructor(){this.bindShareButtons()}bindShareButtons(){document.querySelectorAll(".share-button").forEach(i=>{i.addEventListener("click",e=>{e.preventDefault();var e=i.getAttribute("href"),t=screen.width/2-300;window.open(e,"分享",`toolbar=no, location=no, directories=no, status=no, menubar=no, 
                     scrollbars=no, resizable=no, copyhistory=no, width=600, 
                     height=400, top=${screen.height/2-200}, left=`+t)})})}}new SocialShare;class StatisticsCollector{constructor(){this.sessionId=this.generateSessionId(),this.pageLoadTime=performance.now(),this.interactions=[],this.init()}init(){this.trackPageview(),this.trackInteractions(),this.trackEngagement()}generateSessionId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}trackPageview(){var e={page_id:window.pageId,url:window.location.href,referrer:document.referrer,screen_size:window.innerWidth+"x"+window.innerHeight,load_time:performance.now()};this.sendData("pageview",e)}trackInteractions(){document.addEventListener("click",e=>{e=e.target.closest("a, button, .clickable");e&&this.logInteraction("click",{element:e.tagName,text:e.textContent,href:e.href||null})}),document.addEventListener("submit",e=>{this.logInteraction("form_submit",{form_id:e.target.id||null,form_action:e.target.action})});let t=0;window.addEventListener("scroll",this.throttle(()=>{var e=(window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100;e>t&&(t=e)%25==0&&this.logInteraction("scroll_depth",{depth:t})},500))}trackEngagement(){let e=Date.now(),t=!0;document.addEventListener("visibilitychange",()=>{t=document.hidden?(this.logEngagementTime(e),!1):(e=Date.now(),!0)}),window.addEventListener("beforeunload",()=>{t&&this.logEngagementTime(e)})}logEngagementTime(e){e=Date.now()-e;this.logInteraction("engagement_time",{duration:e})}logInteraction(e,t){e={type:e,data:t,timestamp:Date.now()};this.interactions.push(e),this.sendData("interaction",e)}async sendData(t,i){try{if(!(await fetch(wpAjax.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"log_statistics",nonce:wpAjax.statisticsNonce,type:t,data:JSON.stringify(i)})})).ok)throw new Error("Network response was not ok")}catch(e){console.error("Statistics error:",e),this.storeFailedData(t,i)}}storeFailedData(e,t){var i=JSON.parse(localStorage.getItem("failed_statistics")||"[]");i.push({type:e,data:t,timestamp:Date.now()}),localStorage.setItem("failed_statistics",JSON.stringify(i))}throttle(t,i){let a;return function(){var e=arguments;a||(t.apply(this,e),a=!0,setTimeout(()=>a=!1,i))}}}document.addEventListener("DOMContentLoaded",()=>{new StatisticsCollector});
//# sourceMappingURL=combined.min.js.map
